@model CondoManagementWebApp.Models.SysAdminDashboardViewModel

@{
    ViewData["Title"] = "SysAdminDashboard";
}

<div class="row d-flex justify-content-between align-items-center mb-4">
    <div class="col-auto">
        <h1 class="mb-0">Manage users</h1>
    </div>
    <div class="col-auto">
        @* Barra de busca com formulário *@
        <form asp-action="SearchUsers" asp-controller="Account" method="post">
            <div class="input-group search-area d-xl-inline-flex d-none border shadow-sm rounded">
                <input class="form-control" type="text" name="SearchTerm" placeholder="Search Here" aria-label="Search" />
                <button class="input-group-text bg-white border-start-0">
                    <span>
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M23.707 22.293L19.314 17.9A9.953 9.953 0 0 0 20 10c0-5.514-4.486-10-10-10S0 4.486 0 10s4.486 10 10 10c2.396 0 4.604-.848 6.357-2.268l4.394 4.393a1 1 0 0 0 1.414 0 1 1 0 0 0 0-1.414zM10 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z" fill="#000000" />
                        </svg>
                    </span>
                </button>
            </div>
        </form>
    </div>
</div>




@* Accordion for Condo Members *@
<div class="accordion" id="accordionCondoMembers">
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingCondoMembers">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCondoMembers" aria-expanded="true" aria-controls="collapseCondoMembers">
                Condo Members
            </button>
        </h2>
        <div id="collapseCondoMembers" class="accordion-collapse collapse show" aria-labelledby="headingCondoMembers" data-bs-parent="#accordionCondoMembers">
            <div class="accordion-body">
                <table class="table">
                    @if (Model.CondoMembers != null && Model.CondoMembers.Any())
                    {
                        <thead>
                            <tr>
                                <th></th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Status</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var member in Model.CondoMembers)
                            {
                                <tr>
                                    <td>
                                        <img src="@(member.ImageFullPath)" alt="User Image" class="rounded-circle" style="width: 40px; height: 40px; object-fit: cover;" />
                                    </td>
                                    <td>@member.FullName</td>
                                    <td>@member.Email</td>
                                    <td>
                                        <label class="form-check-label" for="memberSwitch_@member.Email">@(member.IsActive ? "Active" : "Inactive")</label>
                                    </td>
                                    <td><a class="btn btn-outline-primary" asp-controller="Account" asp-action="EditUserDetails" asp-route-email="@member.Email">Edit Details</a></td>
                                    <td><a class="btn btn-outline-secondary" asp-controller="Account" asp-action="AssignCompany" asp-route-email="@member.Email">Manage Companies</a></td>
                                </tr>
                            }
                        </tbody>
                    }
                    else
                    {
                        <tr><td colspan="2" class="text-center text-muted">No condo members found.</td></tr>
                    }
                </table>
            </div>
        </div>
    </div>
</div>


@* Accordion for Company Admins *@
<div class="accordion mt-4" id="accordionCompanyAdmins">
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingCompanyAdmins">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCompanyAdmins" aria-expanded="false" aria-controls="collapseCompanyAdmins">
                Company Admins
            </button>
        </h2>
        <div id="collapseCompanyAdmins" class="accordion-collapse collapse" aria-labelledby="headingCompanyAdmins" data-bs-parent="#accordionCompanyAdmins">
            <div class="accordion-body">
                <table class="table">
                    @if (Model.CompanyAdmins != null && Model.CompanyAdmins.Any())
                    {
                        <thead>
                            <tr>
                                <th></th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Status</th>
                                <th>Company</th>
                                <th></th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var admin in Model.CompanyAdmins)
                            {
                                <tr>
                                    <td>
                                        <img src="@(admin.ImageFullPath)" alt="User Image" class="rounded-circle" style="width: 40px; height: 40px; object-fit: cover;" />
                                    </td>
                                    <td>@admin.FullName</td>
                                    <td>@admin.Email</td>
                                    <td>
                                        <label class="form-check-label" for="memberSwitch_@admin.Email">@(admin.IsActive ? "Active" : "Inactive")</label>
                                    </td>
                                   
                                        @if (!admin.CompaniesDto.Any())
                                        {
                                        <td style="color: red; font-weight: bold;">No Company Assigned</td>
                                        }
                                        else
                                        {
                                        <td>@admin.CompaniesDto.First().Name</td>
                                        }
                                 
                                    <td><a class="btn btn-outline-primary" asp-controller="Account" asp-action="EditUserDetails" asp-route-email="@admin.Email">Edit Details</a></td>
                                    <td><a class="btn btn-outline-secondary" asp-controller="Account" asp-action="AssignCompany" asp-route-email="@admin.Email">Manage Company</a></td>
                                </tr>
                            }
                        </tbody>
                    }
                    else
                    {
                        <tbody>
                            <tr><td colspan="2" class="text-center text-muted">No company admins found.</td></tr>
                        </tbody>
                    }
                </table>
            </div>
        </div>
    </div>
</div>

@* Accordion for Condo Managers *@
<div class="accordion mt-4" id="accordionCondoManagers">
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingCondoManagers">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCondoManagers" aria-expanded="false" aria-controls="collapseCondoManagers">
                Condo Managers
            </button>
        </h2>
        <div id="collapseCondoManagers" class="accordion-collapse collapse" aria-labelledby="headingCondoManagers" data-bs-parent="#accordionCondoManagers">
            <div class="accordion-body">
                <table class="table">
                    @if (Model.CondoManagers != null && Model.CondoManagers.Any())
                    {
                        <thead>
                            <tr>
                                <th></th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Status</th>
                                <th>Company</th>
                                <th></th> <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var manager in Model.CondoManagers)
                            {
                                <tr>
                                    <td>
                                        <img src="@(manager.ImageFullPath)" alt="User Image" class="rounded-circle" style="width: 40px; height: 40px; object-fit: cover;" />
                                    </td>
                                    <td>@manager.FullName</td>
                                    <td>@manager.Email</td>
                                    <td>
                                        <label class="form-check-label" for="memberSwitch_@manager.Email">@(manager.IsActive ? "Active" : "Inactive")</label>
                                    </td>
                                    @if(!manager.CompaniesDto.Any())
                                    {
                                        <td style="color: red; font-weight: bold;">No Company Assigned</td>
                                    }
                                    else
                                    {
                                        <td>@manager.CompaniesDto.First().Name</td>
                                    }
                                    <td><a class="btn btn-outline-primary" asp-controller="Account" asp-action="EditUserDetails" asp-route-email="@manager.Email">Edit Details</a></td>
                                    <td><a class="btn btn-outline-secondary" asp-controller="Account" asp-action="AssignCompany" asp-route-email="@manager.Email">Manage Company</a></td>

                                </tr>
                            }
                        </tbody>
                    }
                    else
                    {
                        <tbody>
                            <tr><td colspan="2" class="text-center text-muted">No condo managers found.</td></tr>
                        </tbody>
                    }
                </table>
            </div>
        </div>
    </div>
</div>

@* Modal de Homônimos *@
<div id="homonymDialog" class="modal fade" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Multiple users found</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Multiple users were found with that name. Please select the correct user:</p>
                <ul class="list-group">
                    @if (Model.HasHomonyms)
                    {
                        @foreach (var user in Model.HomonymUsers)
                        {
                            <li class="list-group-item">
                                <a asp-controller="Account" asp-action="EditUserDetails" asp-route-email="@user.Email">
                                    @user.FullName (@user.Email)
                                </a>
                            </li>
                        }
                    }
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    @* Se o modelo indicar homônimos, exibir o modal *@
    <script type="text/javascript">
        $(document).ready(function () {
        @if (Model.HasHomonyms)
        {
            <text>
                        $('#homonymDialog').modal('show');
            </text>
        }
        });
    </script>
}