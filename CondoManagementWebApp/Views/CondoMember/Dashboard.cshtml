@model CondoManagementWebApp.Models.CondoMemberDashboardViewModel

@{
    ViewData["Title"] = "Dashboard";
}

<div class="container mt-4 text-dark">

    <!-- Member profile -->
    <div class="d-flex align-items-center mb-4">
        <img src="@Model.CondoMemberDto?.ImageFullPath"
             alt="Member photo"
             class="rounded-circle me-3 border"
             style="width: 80px; height: 80px; object-fit: cover;" />
        <div>
            <h2 class="mb-0 text-dark">@Model.CondoMemberDto?.FullName</h2>
            <small class="text-secondary">@Model.CondoMemberDto?.Email</small>
        </div>
    </div>

    <div class="accordion" id="dashboardAccordion">

        <!-- Units -->
        <div class="accordion-item mb-2 rounded shadow-sm">
            <h2 class="accordion-header" id="headingUnits">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseUnits" aria-expanded="true" aria-controls="collapseUnits">
                    My Units
                </button>
            </h2>
            <div id="collapseUnits" class="accordion-collapse collapse show" aria-labelledby="headingUnits" data-bs-parent="#dashboardAccordion">
                <div class="accordion-body p-0">
                    <div class="card bg-white border border-light shadow-sm rounded text-dark">
                        <div class="card-body">
                            @if (Model.UnitDtos != null && Model.UnitDtos.Any())
                            {
                                <ul class="list-group">
                                    @foreach (var unit in Model.UnitDtos)
                                    {
                                        <li class="list-group-item d-flex justify-content-between align-items-center text-dark">
                                            <div>
                                                <strong>Condominium:</strong> @unit.CondominiumDto?.CondoName <br />
                                                <strong>Unit:</strong> Door @unit.Door, Floor @unit.Floor
                                            </div>
                                            <span class="badge bg-primary">Bedrooms: @unit.Bedrooms</span>
                                        </li>
                                    }
                                </ul>
                            }
                            else
                            {
                                <p class="text-secondary">No units found.</p>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Messages -->
        <div class="accordion-item mb-2 rounded shadow-sm">
            <h2 class="accordion-header" id="headingMessages">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMessages" aria-expanded="false" aria-controls="collapseMessages">
                    Recent Messages
                </button>
            </h2>
            <div id="collapseMessages" class="accordion-collapse collapse" aria-labelledby="headingMessages" data-bs-parent="#dashboardAccordion">
                <div class="accordion-body p-0">
                    <div class="card bg-white border border-light shadow-sm rounded text-dark">
                        <div class="card-body">
                            @if (Model.MessageDtos != null && Model.MessageDtos.Any())
                            {
                                <div class="list-group">
                                    @foreach (var msg in Model.MessageDtos
                                                                    .OrderByDescending(m => m.PostingDate)
                                                                    .Take(5))
                                    {
                                        <a href="#" class="list-group-item list-group-item-action text-dark">
                                            <div class="d-flex w-100 justify-content-between">
                                                <h6 class="mb-1 text-dark">@msg.MessageTitle</h6>
                                                <small class="text-secondary">@msg.PostingDate?.ToString("MM/dd/yyyy")</small>
                                            </div>
                                            <p class="mb-1">@msg.MessageContent</p>
                                        </a>
                                    }
                                </div>
                            }
                            else
                            {
                                <p class="text-secondary">No messages received.</p>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Financial Account -->
        <div class="accordion-item mb-2 rounded shadow-sm">
            <h2 class="accordion-header" id="headingFinance">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFinance" aria-expanded="false" aria-controls="collapseFinance">
                    My Financial Account
                </button>
            </h2>
            <div id="collapseFinance" class="accordion-collapse collapse" aria-labelledby="headingFinance" data-bs-parent="#dashboardAccordion">
                <div class="accordion-body p-0">
                    <div class="card bg-white border border-light shadow-sm rounded text-dark">
                        <div class="card-body">
                            @if (Model.FinancialAccountDto != null)
                            {
                                <h5 class="card-title text-dark">Current Balance</h5>
                                <p class="fs-4 fw-bold text-success">@Model.FinancialAccountDto.Balance.ToString("C")</p>
                                <small class="text-secondary">Last update: @DateTime.Now.ToString("MM/dd/yyyy HH:mm")</small>
                            }
                            else
                            {
                                <p class="text-secondary">No financial account linked.</p>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
